<!-- Save as cart.html -->
<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cart â€” Online Courses</title>
<style>
:root{--primary:#E6C23F;--navy:#17314A;--accent:#D97D2E;--bg:#F6F8FB;--card:#fff;--muted:#6b7280;--shadow:0 8px 24px rgba(23,49,74,0.06);font-family:Inter,system-ui,Roboto;}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--navy)}.wrap{max-width:1150px;margin:28px auto;padding:0 18px}
header{display:flex;justify-content:space-between;align-items:center;padding:18px;background:var(--navy);color:#fff;border-radius:10px;box-shadow:var(--shadow)}nav a{color:#fff;margin-left:18px;text-decoration:none}
h1{font-size:32px;margin:18px 0}
.layout{display:grid;grid-template-columns:1fr 360px;gap:20px}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow);border:1px solid rgba(23,49,74,0.04)}
.item{display:flex;gap:14px;padding:12px 0;border-bottom:1px solid rgba(23,49,74,0.06);align-items:flex-start}
.thumb{width:84px;height:84px;border-radius:10px;overflow:hidden;background:#f0f4ff;display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover}
.meta{flex:1}
.meta h3{margin:0;font-size:18px}
.meta p{margin:4px 0;color:var(--muted)}
.price{min-width:90px;text-align:right;font-weight:800}
.controls{display:flex;gap:8px;margin-top:8px}
.btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(23,49,74,0.08);background:transparent;cursor:pointer;font-weight:700}
.btn-remove{border-color:var(--accent);color:var(--accent)}
.btn-save{border-color:var(--primary);color:var(--navy);background:linear-gradient(#fff,#fff)}
.qty{display:flex;gap:6px;align-items:center}
.qty button{width:30px;height:30px;border-radius:8px;border:1px solid rgba(23,49,74,0.06);background:#fff;cursor:pointer}
.summary h2{margin-top:0}
.row{display:flex;justify-content:space-between;padding:6px 0;color:var(--muted)}
.row.total{font-weight:800;color:var(--navy);border-top:1px solid rgba(23,49,74,0.06);padding-top:10px;margin-top:10px}
.coupon{display:flex;gap:8px;margin-top:12px}
.coupon input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(23,49,74,0.06)}
.coupon button{padding:10px 14px;border-radius:8px;border:0;background:var(--navy);color:#fff;font-weight:800;cursor:pointer}
.saved-list{margin-top:18px}
.recommend{margin-top:18px}
.recommend-cards{display:flex;gap:12px;overflow:auto;padding-top:8px}
.rec{min-width:180px;background:var(--card);padding:10px;border-radius:10px;box-shadow:var(--shadow);border:1px solid rgba(23,49,74,0.04)}
.rec img{width:100%;height:90px;object-fit:cover;border-radius:8px}
@media(max-width:980px){.layout{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="font-weight:800">ONLINE COURSES</div>
      <nav><a href="catalog.html">Catalog</a><a href="cart.html">Cart</a><a href="admin_orders.html">Admin</a></nav>
    </header>

    <h1>Shopping Cart</h1>
    <div class="layout">
      <section class="card" id="cartSection" aria-live="polite">
        <!-- items will render here -->
        <div id="cartItems"></div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:14px">
          <input id="coupon" placeholder="Coupon code" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(23,49,74,0.06)">
          <button id="applyCoupon" class="btn" style="background:var(--primary);color:var(--navy);border:0">Apply</button>
        </div>

        <div class="saved-list card" id="savedList" style="margin-top:18px">
          <h3>Saved for later</h3>
          <div id="savedItems"></div>
        </div>

        <div class="recommend card" id="recommender" style="margin-top:18px">
          <h3>People who bought this also bought...</h3>
          <div class="recommend-cards" id="recs"></div>
        </div>
      </section>

      <aside class="card summary">
        <h2>Cart Summary</h2>
        <div class="row"><span>Subtotal</span><span id="sub">$0</span></div>
        <div class="row"><span>Discount</span><span id="disc">-$0</span></div>
        <div class="row"><span>Tax</span><span id="tax">$0</span></div>
        <div class="row total"><span>Total</span><span id="total">$0</span></div>

        <div class="coupon">
          <button onclick="location.href='catalog.html'" class="btn">Continue Shopping</button>
          <button id="checkoutBtn" class="btn" style="background:var(--primary);color:var(--navy);border:0">Checkout</button>
        </div>
        <div style="font-size:13px;color:var(--muted);margin-top:10px">Demo checkout (no real charges). Save invoice after order.</div>
      </aside>
    </div>
  </div>

<script>
// localStorage keys
const LS_CART='oc_cart_v1',LS_SAVED='oc_saved_v1',LS_ORDERS='oc_orders_v1';

function getLS(k){ try{return JSON.parse(localStorage.getItem(k))||[]}catch(e){return []}}
function setLS(k,v){ localStorage.setItem(k,JSON.stringify(v))}

const cartItemsEl=document.getElementById('cartItems');
const savedItemsEl=document.getElementById('savedItems');
const recsEl=document.getElementById('recs');
const subEl=document.getElementById('sub'), discEl=document.getElementById('disc'), taxEl=document.getElementById('tax'), totalEl=document.getElementById('total');

const SAMPLE_RECS = [
  {id:'r1',title:'Intro to Figma',price:59,img:'https://images.unsplash.com/photo-1551434678-e076c223a692?w=900&q=60'},
  {id:'r2',title:'Responsive Design',price:69,img:'https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=900&q=60'},
  {id:'r3',title:'Javascript ES6',price:89,img:'https://images.unsplash.com/photo-1518770660439-4636190af475?w=900&q=60'}
];

function renderCart(){
  const cart=getLS(LS_CART);
  cartItemsEl.innerHTML='';
  if(cart.length===0){
    cartItemsEl.innerHTML='<div style="padding:12px;color:var(--muted)">Your cart is empty</div>';
  } else {
    cart.forEach(item=>{
      const div=document.createElement('div'); div.className='item';
      div.innerHTML = `
        <div class="thumb"><img src="${item.img||'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=900&q=60'}" alt="${escape(item.title)}"></div>
        <div class="meta">
          <h3>${escape(item.title)}</h3>
          <p class="muted">by ${escape(item.instructor||'Unknown')}</p>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <div class="qty">
              <button data-id="${item.id}" data-action="dec">-</button>
              <input style="width:44px;text-align:center;border:1px solid rgba(23,49,74,0.06);padding:6px;border-radius:8px" data-id="${item.id}" value="${item.quantity}">
              <button data-id="${item.id}" data-action="inc">+</button>
            </div>
            <button class="btn btn-save" data-id="${item.id}" data-action="save">Save for later</button>
            <button class="btn btn-remove" data-id="${item.id}" data-action="remove">Remove</button>
          </div>
        </div>
        <div class="price">$${(item.price*item.quantity).toFixed(2)}</div>
      `;
      cartItemsEl.appendChild(div);
    });
  }
  attachCartListeners();
  computeSummary();
}

function renderSaved(){
  const saved = getLS(LS_SAVED);
  savedItemsEl.innerHTML='';
  if(saved.length===0) savedItemsEl.innerHTML='<div style="color:var(--muted);padding:8px">No saved courses</div>';
  saved.forEach(s=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `
      <div class="thumb"><img src="${s.img||'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=900&q=60'}" alt="${escape(s.title)}"></div>
      <div class="meta">
        <h3>${escape(s.title)}</h3>
        <p class="muted">by ${escape(s.instructor||'Unknown')}</p>
        <div class="controls" style="margin-top:8px;">
          <button class="btn" data-id="${s.id}" data-action="move">Move to cart</button>
          <button class="btn btn-remove" data-id="${s.id}" data-action="removeSaved">Remove</button>
        </div>
      </div>
      <div class="price">$${s.price}</div>
    `;
    savedItemsEl.appendChild(div);
  });
  attachSavedListeners();
}

function renderRecs(){
  recsEl.innerHTML='';
  SAMPLE_RECS.forEach(r=>{
    const d = document.createElement('div'); d.className='rec';
    d.innerHTML = `<img src="${r.img}" alt=""><div style="font-weight:700;margin-top:6px">${escape(r.title)}</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><div style="font-weight:800">$${r.price}</div><button class="btn" data-id="${r.id}" data-action="addrec">Add</button></div>`;
    recsEl.appendChild(d);
  });
  document.querySelectorAll('[data-action="addrec"]').forEach(b=>b.addEventListener('click',e=>{
    const id=e.currentTarget.dataset.id; const r=SAMPLE_RECS.find(x=>x.id===id);
    const cart=getLS(LS_CART);
    if(cart.some(i=>i.title===r.title)){ alert('Already in cart'); return; }
    cart.push({id:'rec-'+Date.now(), title:r.title, price:r.price, quantity:1, img:r.img});
    setLS(LS_CART,cart); renderCart(); alert('Added recommended course to cart'); 
  }));
}

// compute totals (coupon simple demo)
function computeSummary(){
  const cart=getLS(LS_CART);
  let sub=0; cart.forEach(i=>sub += (i.price * (i.quantity||1)));
  let disc = 0;
  const coupon = sessionStorage.getItem('oc_coupon') || '';
  if(coupon==='STUDENT10') disc = sub * 0.10;
  const tax = 0; const total = sub - disc + tax;
  subEl.textContent = '$'+sub.toFixed(2);
  discEl.textContent = '-$'+disc.toFixed(2);
  taxEl.textContent = '$'+tax.toFixed(2);
  totalEl.textContent = '$'+total.toFixed(2);
}

// attach buttons (cart)
function attachCartListeners(){
  document.querySelectorAll('[data-action]').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const id = e.currentTarget.dataset.id;
      const action = e.currentTarget.dataset.action;
      if(action==='inc' || action==='dec'){
        const cart = getLS(LS_CART);
        const idx = cart.findIndex(i=>i.id===id);
        if(idx>-1){
          if(action==='inc') cart[idx].quantity = (cart[idx].quantity||1)+1;
          if(action==='dec') cart[idx].quantity = Math.max(1,(cart[idx].quantity||1)-1);
          setLS(LS_CART,cart); renderCart();
        }
      } else if(action==='remove'){
        if(!confirm('Remove this item?')) return;
        let cart = getLS(LS_CART).filter(i=>i.id!==id); setLS(LS_CART,cart); renderCart();
      } else if(action==='save'){
        const cart = getLS(LS_CART);
        const idx = cart.findIndex(i=>i.id===id);
        if(idx>-1){
          const item = cart.splice(idx,1)[0];
          const saved = getLS(LS_SAVED);
          saved.push(item); setLS(LS_SAVED,saved); setLS(LS_CART,cart);
          renderCart(); renderSaved();
        }
      }
    });
  });

  // inputs quantity manual changes
  document.querySelectorAll('.qty input').forEach(inp=>{
    inp.addEventListener('change',e=>{
      const id = e.target.dataset.id; let v = parseInt(e.target.value)||1;
      const cart = getLS(LS_CART); const idx = cart.findIndex(i=>i.id===id);
      if(idx>-1){ cart[idx].quantity = Math.max(1,v); setLS(LS_CART,cart); renderCart(); }
    });
  });
}

function attachSavedListeners(){
  document.querySelectorAll('[data-action="move"]').forEach(b=>{
    b.addEventListener('click',e=>{
      const id=e.currentTarget.dataset.id;
      const saved = getLS(LS_SAVED);
      const idx = saved.findIndex(i=>i.id===id);
      if(idx>-1){
        const item = saved.splice(idx,1)[0];
        const cart = getLS(LS_CART);
        cart.push(item); setLS(LS_CART,cart); setLS(LS_SAVED,saved); renderCart(); renderSaved();
      }
    });
  });
  document.querySelectorAll('[data-action="removeSaved"]').forEach(b=>{
    b.addEventListener('click',e=>{
      const id=e.currentTarget.dataset.id;
      let saved = getLS(LS_SAVED).filter(x=>x.id!==id); setLS(LS_SAVED,saved); renderSaved();
    });
  });
}

// coupon
document.getElementById('applyCoupon').addEventListener('click',()=>{
  const code = document.getElementById('coupon').value.trim();
  if(code==='STUDENT10'){ sessionStorage.setItem('oc_coupon','STUDENT10'); alert('Coupon applied: 10% off'); computeSummary(); }
  else { alert('Invalid coupon (demo supports STUDENT10)'); }
});

// checkout goto
document.getElementById('checkoutBtn').addEventListener('click',()=>{
  const cart=getLS(LS_CART);
  if(cart.length===0){ alert('Cart empty'); return; }
  location.href='checkout.html';
});

// small utility
function escape(s){ return String(s).replace(/[&<>"']/g, ch=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]))}

// initial render uses sample items if empty (for demo)
(function init(){
  // If cart empty, seed with two sample items from catalog to demo
  if(getLS(LS_CART).length===0){
    setLS(LS_CART,[
      {id:'c02',title:'Web Development Bootcamp',price:49,quantity:1,instructor:'John Doe',img:'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=900&q=60'},
      {id:'c01',title:'Introduction to Python',price:49,quantity:1,instructor:'Jane Smith',img:'https://images.unsplash.com/photo-1526378721274-1d3b6a9a5e26?w=900&q=60'}
    ]);
  }
  renderCart(); renderSaved(); renderRecs();
})();
</script>
</body>
</html>
